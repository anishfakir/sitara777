const firebaseConfig={apiKey:"AIzaSyAMRnkfwHwca2Nr0irw-VD0Zld5EbFqq9w",authDomain:"sitara777-admin-api.firebaseapp.com",databaseURL:"https://sitara777-admin-api-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"sitara777-admin-api",storageBucket:"sitara777-admin-api.firebasestorage.app",messagingSenderId:"429791374831",appId:"1:429791374831:web:4c40138467bc41416c5a1a"};firebase.initializeApp(firebaseConfig);const auth=firebase.auth();const database=firebase.database();const DB_PATHS={BAZAARS:"bazaars",BETS:"bets",BET_TYPES:"betTypes",USERS:"users",TRANSACTIONS:"transactions",RESULTS:"results",AUDIT:"audit",SETTINGS:"settings",ADMINS:"admins"};const BAZAAR_STATUSES={ACTIVE:"active",INACTIVE:"inactive",UPCOMING:"upcoming"};const BET_STATUSES={PENDING:"pending",ACCEPTED:"accepted",REJECTED:"rejected",SETTLED:"settled",WON:"won",LOST:"lost"};const USER_STATUSES={ACTIVE:"active",BLOCKED:"blocked"};const TRANSACTION_STATUSES={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected",COMPLETED:"completed"};const TRANSACTION_TYPES={RECHARGE:"recharge",WITHDRAWAL:"withdrawal",BET:"bet",PAYOUT:"payout",DEBIT:"debit"};const BET_TYPES={SINGLE:"Single",JODI:"Jodi",PANNA_SINGLE:"Panna Single",PANNA_DOUBLE:"Panna Double",PANNA_TRIPLE:"Panna Triple",SANGAM:"Sangam",HALF_SANGAM:"Half Sangam",CP:"CP",DP:"DP",TP:"TP"};const VALIDATION_SCHEMAS={BAZAAR:{bazaarName:{required:true,type:"string",minLength:2,maxLength:100},description:{required:false,type:"string",maxLength:500},status:{required:true,enum:Object.values(BAZAAR_STATUSES)},openTime:{required:true,type:"time"},closeTime:{required:true,type:"time"}}};const validateData=(data,schema)=>{const errors=[];for(const[field,rules]of Object.entries(schema)){const value=data[field];if(rules.required&&(!value||value==="")){errors.push(`${field} is required`);continue}if(value!==undefined&&value!==null&&value!==""){if(rules.type==="string"&&typeof value!=="string"){errors.push(`${field} must be a string`)}else if(rules.type==="number"&&typeof value!=="number"){errors.push(`${field} must be a number`)}else if(rules.type==="date"&&!isValidDate(value)){errors.push(`${field} must be a valid date`)}else if(rules.type==="time"&&!isValidTime(value)){errors.push(`${field} must be a valid time`)}if(rules.minLength&&value.length<rules.minLength){errors.push(`${field} must be at least ${rules.minLength} characters`)}if(rules.maxLength&&value.length>rules.maxLength){errors.push(`${field} must be at most ${rules.maxLength} characters`)}if(rules.min!==undefined&&value<rules.min){errors.push(`${field} must be at least ${rules.min}`)}if(rules.max!==undefined&&value>rules.max){errors.push(`${field} must be at most ${rules.max}`)}if(rules.enum&&!rules.enum.includes(value)){errors.push(`${field} must be one of: ${rules.enum.join(", ")}`)}}}return{isValid:errors.length===0,errors:errors}};const isValidDate=(dateString)=>{const date=new Date(dateString);return date instanceof Date&&!isNaN(date)};const isValidTime=(timeString)=>{const timeRegex=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;return timeRegex.test(timeString)};const formatCurrency=(amount)=>{return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(amount)};const formatDate=(timestamp)=>{if(!timestamp)return"-";return new Date(timestamp).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};const generateId=()=>{return Date.now().toString(36)+Math.random().toString(36).substr(2)};auth.onAuthStateChanged((user)=>{if(user){console.log("User signed in:",user.email);checkAdminStatus(user.uid)}else{console.log("User signed out");redirectToLogin()}});const checkAdminStatus=async(uid)=>{try{const adminSnapshot=await database.ref(`${DB_PATHS.ADMINS}/${uid}`).once("value");if(adminSnapshot.exists()){const adminData=adminSnapshot.val();if(adminData.isAdmin){console.log("Admin access confirmed");sessionStorage.setItem("adminData",JSON.stringify(adminData));return true}}await auth.signOut();showAlert("danger","Access denied. Admin privileges required.");return false}catch(error){console.error("Error checking admin status:",error);await auth.signOut();showAlert("danger","Error verifying admin access.");return false}};const redirectToLogin=()=>{if(window.location.pathname!=="/login.html"&&window.location.pathname!=="/"){window.location.href="/login.html"}};const logAuditAction=async(action,userId,userName,resourceType,resourceId,description,severity="medium")=>{try{const auditLog={action,userId,userName,resourceType,resourceId,description,severity,timestamp:Date.now(),ipAddress:"127.0.0.1"};await database.ref(DB_PATHS.AUDIT).push(auditLog);console.log(`Audit logged: ${action} - ${description}`)}catch(error){console.error("Error logging audit:",error)}};const showAlert=(type,message)=>{const alertContainer=document.getElementById("alertContainer");if(alertContainer){const alert=document.createElement("div");alert.className=`alert alert-${type} alert-dismissible fade show`;alert.innerHTML=`<i class="fas fa-${type==="success"?"check-circle":type==="danger"?"exclamation-circle":"info-circle"}"></i>${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;alertContainer.appendChild(alert);setTimeout(()=>{if(alert.parentNode){alert.remove()}},5000)}};window.DB_PATHS=DB_PATHS;window.BAZAAR_STATUSES=BAZAAR_STATUSES;window.BET_STATUSES=BET_STATUSES;window.USER_STATUSES=USER_STATUSES;window.TRANSACTION_STATUSES=TRANSACTION_STATUSES;window.TRANSACTION_TYPES=TRANSACTION_TYPES;window.BET_TYPES=BET_TYPES;window.VALIDATION_SCHEMAS=VALIDATION_SCHEMAS;window.validateData=validateData;window.formatCurrency=formatCurrency;window.formatDate=formatDate;window.generateId=generateId;window.logAuditAction=logAuditAction;window.showAlert=showAlert;window.auth=auth;window.database=database;console.log("ðŸ”¥ Firebase initialized for Sitara777 Satka Matka Admin Panel");
